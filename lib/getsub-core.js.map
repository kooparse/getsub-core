{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 9a73d9cf2460fb5e794f","webpack:///./src/index.js","webpack:///external \"babel-runtime/regenerator\"","webpack:///external \"babel-runtime/helpers/asyncToGenerator\"","webpack:///external \"fuse.js\"","webpack:///./src/utils.js","webpack:///./src/opensubtitle.js","webpack:///external \"opensubtitles\"","webpack:///external \"node-uuid\"","webpack:///./src/addic7ed.js","webpack:///external \"addic7ed-api\""],"names":[],"mappings":"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","file":"getsub-core.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"babel-runtime/regenerator\"), require(\"babel-runtime/helpers/asyncToGenerator\"), require(\"fuse.js\"), require(\"opensubtitles\"), require(\"node-uuid\"), require(\"addic7ed-api\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"babel-runtime/regenerator\", \"babel-runtime/helpers/asyncToGenerator\", \"fuse.js\", \"opensubtitles\", \"node-uuid\", \"addic7ed-api\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"getsub-core\"] = factory(require(\"babel-runtime/regenerator\"), require(\"babel-runtime/helpers/asyncToGenerator\"), require(\"fuse.js\"), require(\"opensubtitles\"), require(\"node-uuid\"), require(\"addic7ed-api\"));\n\telse\n\t\troot[\"getsub-core\"] = factory(root[\"babel-runtime/regenerator\"], root[\"babel-runtime/helpers/asyncToGenerator\"], root[\"fuse.js\"], root[\"opensubtitles\"], root[\"node-uuid\"], root[\"addic7ed-api\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_7__, __WEBPACK_EXTERNAL_MODULE_9__) {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 9a73d9cf2460fb5e794f\n **/","/* API(s) */\nimport Fuse from 'fuse.js'\nimport {isTvShow, extractShow} from './utils'\nimport opensubtitle from './opensubtitle'\nimport addic7ed from './addic7ed'\n\n/**\n * Getsub Search API\n *\n * @param {Object} File object containing our file path and name\n * @param {String} Search language filter\n * @return {Object} Resulted search object (with subtitles list and origin names)\n */\nexport const search = async (file, lang) => {\n  const originName = file.name\n\n  if (isTvShow(originName)) {\n    const info = extractShow(originName)\n    let subtitles = await addic7ed(\n      info.name, info.showIndex[0], info.showIndex[1], lang)\n  }\n\n  return\n  let subtitles = await opensubtitle(originName, file.size, lang)\n  /**\n   * We use Fuse (https://github.com/krisk/Fuse)\n   * to comparing the file name with our list of\n   * subtitles found.\n   *\n   * @return {Array} A new array sorted by score\n   */\n  const fuse = new Fuse(subtitles, {\n    caseSensitive: false,\n    includeScore: false,\n    shouldSort: true,\n    tokenize: false,\n    threshold: 0.6,\n    location: 0,\n    distance: 100,\n    maxPatternLength: originName.length + 8,\n    keys: ['fileName']\n  })\n\n  return {\n    subtitles: fuse.search(originName),\n    originLang: lang,\n    originName\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","module.exports = require(\"babel-runtime/regenerator\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"babel-runtime/regenerator\"\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = require(\"babel-runtime/helpers/asyncToGenerator\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"babel-runtime/helpers/asyncToGenerator\"\n ** module id = 2\n ** module chunks = 0\n **/","module.exports = require(\"fuse.js\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fuse.js\"\n ** module id = 3\n ** module chunks = 0\n **/","const tvShowNamePattern = formatRegex(/(.*)((S\\d\\d)|(\\d+X\\d+))/)\nconst weirdPattern = formatRegex(/(\\d+X\\d+)/)\nconst seasonPattern = formatRegex(/(S\\d\\d)/)\nconst episodePattern = formatRegex(/(E\\d\\d)/)\n\nfunction formatRegex (pattern) {\n  return new RegExp(pattern, 'i')\n}\n\nexport function isTvShow (name) {\n  const pattern = formatRegex(/(S\\d\\d((E\\d\\dE\\d\\d)|(E\\d\\d)))|(\\d+X\\d+)/)\n  return name.match(pattern)\n}\n\nexport function extractShow (name) {\n\n  let result = {\n    name: undefined,\n    showIndex: []\n  }\n\n  if (name.match(tvShowNamePattern)) {\n    result.name = tvShowNamePattern.exec(name)[1]\n  }\n\n  if (name.match(weirdPattern)) {\n    result.showIndex = weirdPattern.exec(name)[0].toUpperCase().split('X')\n  } else {\n    result.showIndex.push(seasonPattern.exec(name)[0].slice(1))\n    result.showIndex.push(episodePattern.exec(name)[0].slice(1))\n  }\n\n  return result\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils.js\n **/","import OS from 'opensubtitles'\nimport uuid from 'node-uuid'\nconst os = new OS()\n\n/**\n * Init function\n *\n * @param {String} Filename\n * @param {Int} File's size\n * @param {String} Search language filter\n * @return {Array} List of subtitles\n */\nexport default async (name, size, lang) => {\n  // TODO: use movieHash to filter our subtitle list\n  const movieHash = await checkMovieHash([size])\n\n  const token = await login()\n  let query = [{sublanguageid: lang, query: name}]\n\n  let subtitles = (await searchSubtitles(token, query))\n    .filter((subtitle) => {\n      return subtitle.SubDownloadLink &&\n        subtitle.IDSubtitleFile &&\n        subtitle.SubFileName &&\n        subtitle.MovieReleaseName\n    })\n    .map((subtitle) => {\n      /* we want to remove .zip ext to directly download .srt */\n      let downloadLink = subtitle.SubDownloadLink\n      downloadLink = downloadLink.substring(0, downloadLink.length - 3)\n\n      return {\n        provider: 'opensubtitle',\n        id: uuid.v4(),\n        subtitleName: subtitle.SubFileName,\n        fileName: subtitle.MovieReleaseName,\n        downloadLink\n      }\n    })\n\n  return subtitles\n}\n\n/**\n * Bind opensubtitles checkMovieHash method\n *\n * @param {Array} Array of files size\n * @return {Array} Array of object with file infos\n */\nconst checkMovieHash = async (sizes) => {\n  return await new Promise((resolve, reject) => {\n    os.checkMovieHash(sizes, (err, res) => {\n      if (err) reject(err)\n      else resolve(res.data)\n    })\n  })\n}\n\n/**\n * Bind opensubtitles login method\n * With filtered response (only Token)\n *\n * @return {String} Token is returned\n */\nconst login = async () => {\n  return new Promise((resolve, reject) => {\n    os.api.LogIn((err, res) => {\n      if (err) reject(err)\n      else resolve(res.token)\n    }, null, null, null, 'OSTestUserAgent')\n  })\n}\n\n/**\n * Bind opensubtitles search for subtitles method\n *\n * @param {String} Token\n * @param {Array} Query (see http://bit.ly/22B0NX4)\n * @return {Array} List of subtitle objects\n */\nconst searchSubtitles = async (token, query) => {\n  return new Promise((resolve, reject) => {\n    os.api.SearchSubtitles((err, res) => {\n      if (err) reject(err)\n      else resolve(res.data)\n    }, token, query)\n  })\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/opensubtitle.js\n **/","module.exports = require(\"opensubtitles\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"opensubtitles\"\n ** module id = 6\n ** module chunks = 0\n **/","module.exports = require(\"node-uuid\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"node-uuid\"\n ** module id = 7\n ** module chunks = 0\n **/","import addic7ed from 'addic7ed-api'\nimport uuid from 'node-uuid'\n\nexport default async (name, season, episode, lang) => {\n  console.log(name, season, episode)\n  await addic7ed.search(name, season, episode, lang)\n    .then((subtitlesList) => {\n      const subInfo = subtitlesList[0];\n      console.log(subInfo)\n    })\n    .catch((err) => {\n      console.log('err', err)\n    })\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/addic7ed.js\n **/","module.exports = require(\"addic7ed-api\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"addic7ed-api\"\n ** module id = 9\n ** module chunks = 0\n **/"],"sourceRoot":""}